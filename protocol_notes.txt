Felicita Scale Protocol Documentation
====================================

Bluetooth Connection
-------------------
Service UUID: 0000FFE0-0000-1000-8000-00805F9B34FB
Characteristic UUID: 0000FFE1-0000-1000-8000-00805F9B34FB
Device Name: "FELICITA"

Packet Structure
----------------
18 bytes total packet length

Bytes 3-9: Weight data (ASCII encoded)
Bytes 9-11: Unit data (text encoded)
Byte 15: Battery level indicator

Weight Data Processing
---------------------
1. Extract weight bytes from positions 3-9
2. Decode ASCII bytes to string, filter for digits only
3. Parse digits as integer
4. Apply unit-specific decimal scaling:
   - Grams: divide by 100 (e.g., "000640" → 6.40g)
   - Ounces: divide by 10000 (e.g., "020140" → 2.014oz)
5. Result is weight in scale's native unit

Unit Detection
--------------
- Extract bytes 9-11 and decode as UTF-8 text
- "g" indicates grams
- "oz" indicates ounces
- Default to grams if unclear

Battery Level
-------------
- Extract byte 15
- Range: 129-158 (MIN_BATTERY_LEVEL to MAX_BATTERY_LEVEL)
- Calculate percentage: ((value - 129) / (158 - 129)) * 100

Control Commands
---------------
Send single byte commands to control the scale:
- 0x52: Start timer
- 0x53: Stop timer  
- 0x43: Reset timer
- 0x42: Toggle timer (start/stop)
- 0x44: Toggle precision mode
- 0x54: Tare (reset to zero)
- 0x55: Toggle unit (grams/ounces)

Stability Detection
-------------------
- Integration computes stability based on consecutive identical readings
- Requires 4 consecutive readings with same value (rounded to 1 decimal)
- Zero weight (0.0g) is never considered stable
- Resets on any weight change

Examples:
--------
Grams example:
Raw packet: [... 48 48 48 54 52 48 103 0 0 ... 145 ...]
Weight bytes (3-9): [48 48 48 54 52 48] → "000540" → 5.40g
Unit bytes (9-11): [103 0 0] → "g" → grams  
Battery byte (15): 145 → ((145-129)/(158-129))*100 = 55%
Result: 5.40g, 55% battery

Ounces example:
Raw packet: [... 48 50 48 49 52 48 111 122 0 ... 145 ...]
Weight bytes (3-9): [48 50 48 49 52 48] → "020140" → 2.014oz
Unit bytes (9-11): [111 122 0] → "oz" → ounces
Battery byte (15): 145 → 55%
Result: 2.014oz, 55% battery

Send tare command: Write [0x54] to characteristic